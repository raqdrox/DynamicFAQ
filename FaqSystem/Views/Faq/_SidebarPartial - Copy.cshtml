@model IEnumerable<FaqSystem.Models.FaqSection>

<nav id="sidebar">
    <div class="sidebar-header">
        <h3>Frequently Asked Questions</h3>
    </div>
    <ul class="list-unstyled components" id="SectionNavList"></ul>

</nav>
<script id="secListElement" type="text/x-handlebars-template">
    <li>
        <a href="#submenu-{{ida}}" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">{{sec}}</a>
        <ul class="collapse list-unstyled" id="submenu-{{ida}}"></ul>
    </li>
</script>

<script id="qListElement" type="text/x-handlebars-template">
    <li><a href="{{lnk}}" data-secId={{secid}} data-qId={{qid}}>{{ques}}</a></li>
</script>

<script id="controlsTmpl" type="text/x-handlebars-template">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">

            <button type="button" id="sidebarCollapse" class="btn btn-info">
                <i class="fas fa-align-left"></i>
                <span>Toggle Sidebar</span>
            </button>
            <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-align-justify"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Page</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Page</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Page</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Page</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</script>
<script type="text/javascript" language="javascript">
    var sectionArray = @Html.Raw(Json.Serialize(Model.ToList()));

    secListEleTmpl = Handlebars.compile(document.getElementById('secListElement').innerHTML);
    qListEleTmpl = Handlebars.compile(document.getElementById('qListElement').innerHTML);

    document.getElementById('secListElement').remove();
    document.getElementById('qListElement').remove();
    document.getElementById('controlsTmpl').remove();

    var secNavList = $("#SectionNavList");
    var hash;
    var currSecId = 0;
    var currQId = 0;

    function setupSectionButtons() {

        for (var i = 0; i < sectionArray.length; i++) {
            var secEle = secListEleTmpl({
                ida: i.toString(),
                id: sectionArray[i].id,
                sec: sectionArray[i].sectionTitle
            });
            var eles = $(secEle);
            secNavList.append(eles);

            for (var x = 0; x < sectionArray[i].qList.length; x++) {
                var qEle = qListEleTmpl({
                    lnk: "#" + sectionArray[i].qList[x].id.toString(),
                    ques: sectionArray[i].qList[x].title,
                    secid: i,
                    qid: sectionArray[i].qList[x].id
                });
                var eleq = $(qEle);
                eles.children("ul").append(eleq);
            }
        }
    }

    

    function getQuesFromQId(id) {
        var ques;
        $.each(sectionArray,
            function (sec) {
                ques = sectionArray[sec].qList.find(x => x.id === id);
                if (!(typeof ques == "undefined")) {
                    return false;
                }
            });
        if (typeof ques == "undefined") {
            return false;
        } else {
            return ques;
        }

    }

    function getSectionFromQId(id) {
        var ques;
        $.each(sectionArray,
            function (sec) {
                ques = sectionArray[sec].qList.find(x => x.id === id);
                if (!(typeof ques == "undefined")) {
                    return sectionArray[sec];
                }
            });
        return false;
    }

    function OnQSelect(queId) {
        var res = getQuesFromQId(queId);
        if (!(res === false)) {
            currQId = res.id ;
            currSecId = getSectionFromQId(currQId);
            
        }

    }

    $(document).ready(function () {
        currSecId = -1;
        currQId = -1;
        setupSectionButtons();


    });


</script>